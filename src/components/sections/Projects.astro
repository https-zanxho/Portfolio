---
import { projects } from "../../data/projects";

interface Props {
  title?: string;
}

const { title } = Astro.props as Props;
---

<section class="w-full py-10">
  <div class="mx-auto max-w-6xl px-4">
    {title && (
      <h2 class="text-3xl md:text-4xl font-semibold text-center mb-8 text-foreground">{title}</h2>
    )}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      {projects.map((p) => (
        <article class="card-surface p-6 relative space-y-4">
  <!-- Thumbnail 16:9 recortado y clickeable -->
  <div
    class="relative w-full overflow-hidden rounded-lg aspect-[16/9] cursor-zoom-in js-open-image"
    data-image={p.image}
    role="button"
    tabindex="0"
    aria-label={`Open image of ${p.title}`}
  >
    <img
      src={p.image}
      alt={p.title}
      class="absolute inset-0 h-full w-full object-cover pointer-events-none"
      loading="lazy"
    />
  </div>

  <h3 class="text-xl font-semibold m-0">{p.title}</h3>
  <p class="text-sm text-[color:var(--color-text-muted)] m-0">{p.techStack}</p>
  <p class="mt-2 text-[color:var(--color-text-secondary)]">{p.description}</p>
</article>

      ))}
    </div>
  </div>
</section>

<!-- Modal para ver la imagen completa -->
<div id="imageModal" class="modal hidden" aria-hidden="true">
  <button class="modal-close" aria-label="Close" onclick="closeImage()">×</button>
  <img id="modalImg" class="modal-img" alt="Preview" />
</div>

<!-- ✅ Script fuera del markup principal -->
<script is:inline>
  function openImage(src) {
    const modal = document.getElementById('imageModal');
    const img = document.getElementById('modalImg');
    if (modal && img && src) {
      img.setAttribute('src', src);
      modal.classList.remove('hidden');
      modal.setAttribute('aria-hidden', 'false');
    }
  }

  function closeImage() {
    const modal = document.getElementById('imageModal');
    if (modal) {
      modal.classList.add('hidden');
      modal.setAttribute('aria-hidden', 'true');
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.js-open-image').forEach((el) => {
      el.addEventListener('click', () => openImage(el.getAttribute('data-image')));
      el.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openImage(el.getAttribute('data-image'));
        }
      });
    });

    // Cerrar con Esc y click fuera
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeImage(); });
    const modal = document.getElementById('imageModal');
    if (modal) {
      modal.addEventListener('click', (e) => {
        if (e.target && e.target.id === 'imageModal') closeImage();
      });
    }
  });
</script>


<style>
  .js-open-image:focus {
    outline: 2px solid rgba(255,255,255,.6);
    outline-offset: 2px;
  }
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 99999;
    padding: 2rem;
    cursor: zoom-out;
  }
  .hidden { display: none; }

  .modal-img {
    max-width: min(90vw, 1200px);
    max-height: 90vh;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0,0,0,.6);
    cursor: default;
  }
  .modal-close {
    position: absolute;
    top: 12px;
    right: 16px;
    font-size: 28px;
    line-height: 1;
    background: transparent;
    border: none;
    color: #fff;
    cursor: pointer;
  }
</style>
